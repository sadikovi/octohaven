(function(){var t,e,n,i,r,o,u,s,l,c,a,d,m,f,h,v,p,b,y,g,E,k,w,C,L;if(y=document.getElementById("octohaven-timetables"),!y)throw new Error("Timetable placeholder is not found");E=this.mapper,L=this.util,k=this.misc,C=new this.TimetableApi,w=["ACTIVE","PAUSED","CANCELLED"],t=w[0],n=w[1],e=w[2],s=function(t,e,n){var i,r;return null==n&&(n=null),i={type:"div",cls:"breadcrumb",children:e},r={type:"div",cls:t+" column",children:i},E.parseMapForParent(r,n)},b=function(i){return i===t?"text-green":i===n?"text-yellow":i===e?"text-red":"text-mute"},r=function(e){return e===t?"Pause":e===n?"Resume":null},d=function(t,e){var n,i;return i={type:"div",cls:""+e,title:""+t},n={type:"div",cls:"section",children:i},s("one-sixth",n)},c=function(t,e){var n,i;return n={type:"a",href:"/timetable?id="+t+"&mode=show",title:""+e},i={type:"div",cls:"section",children:n},s("one-third",i)},a=function(t,e,n){var i,r,o,u,l;return i={type:"span",title:""+t},r={type:"span",cls:"text-mute",title:" scheduled jobs"},o={type:"div",cls:"section",children:[i,r]},u=null,n&&n>0&&(e={type:"a",href:"/job?jobid="+e,title:"latest "},l={type:"span",title:""+L.timestampToDate(n)},u={type:"div",cls:"section",children:[e,l]}),s("one-third",[o,u])},l=function(t,e,n,i){var r,o;return r={type:"div",cls:"btn btn-compact",title:""+e,onclick:function(){return this.uid=t,this.status=n,"function"==typeof i?i(this):void 0}},o={type:"div",cls:"section",children:r},s("one-sixth",o)},v=function(e){var i,o,u,s,m,f,h,v,p,y,g;return g=e.uid,h=e.name,v=e.numjobs,p=e.status,f=e.latestjobid,y=e.latestruntime,m=d(p,b(p)),u=c(g,h),s=a(v,f,y),o=null,i=r(p),i&&(o=l(g,i,p,function(e){var i,r;return i=function(t){return function(){return L.addClass(e,"btn-disabled"),e.innerHTML="???"}}(this),r=function(n){return function(n){return L.addClass(e,"btn-disabled"),n?e.innerHTML=e.status===t?"Paused":"Active":e.innerHTML="Error"}}(this),e.status===t?C.pause(e.uid,function(){return i()},function(t,e){return r(t)}):e.status===n?C.resume(e.uid,function(){return i()},function(t,e){return r(t)}):void 0})),k.segment(k.columns([m,u,s,o]))},g=function(t){return C.list(!1,t,function(){return y.innerHTML=""},function(t,e){var n,i,r,o,u,s;return t?(u=e.content.timetables,u&&u.length>0?(r=[function(){var t,e,n;for(n=[],t=0,e=u.length;e>t;t++)o=u[t],n.push(v(o));return n}()],k.segments(r,y)):(s=k.blankslateWithMsg("No timetables found :(","You can create a timetable for any job from job details view"),E.parseMapForParent(s,y))):(n=e?e.content.msg:"We know and keep working on that",i=k.blankslateWithMsg("Something went wrong :(",n),E.parseMapForParent(i,y))})},m=document.getElementById("octohaven-timetables-noncancelled"),o=document.getElementById("octohaven-timetables-active"),f=document.getElementById("octohaven-timetable-paused"),u=document.getElementById("octohaven-timetable-cancelled"),h=function(){return L.removeClass(m,"selected"),L.removeClass(o,"selected"),L.removeClass(f,"selected"),L.removeClass(u,"selected")},p=function(t){return L.addClass(t,"selected")},i=function(t,e,n){return h(),"function"==typeof g&&g(n),p(e),null!=t&&t.preventDefault(),null!=t?t.stopPropagation():void 0},L.addEventListener(m,"click",function(e){return i(e,m,[t,n])}),L.addEventListener(o,"click",function(e){return i(e,o,[t])}),L.addEventListener(f,"click",function(t){return i(t,f,[n])}),L.addEventListener(u,"click",function(t){return i(t,u,[e])}),i(null,m,[t,n])}).call(this);