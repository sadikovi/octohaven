(function(){var t,e,n,o,r,i,a,u,s,c,p,l,m,f,d,h,g,v,y,b,w,j,M,E,P,I,S,F,C,T,k,x,L,B;if(F=new this.FilelistApi,L=new this.TemplateApi,C=new this.JobApi,B=this.util,T=this.mapper,x=this.namer,k=this.misc,m=document.getElementById("octohaven-job-settings"),!m)throw new Error("Job settings canvas is undefined");if(o=document.getElementById("octohaven-filelist-breadcrumbs"),l=document.getElementById("octohaven-filelist-files"),g=document.getElementById("octohaven-selected-jar"),!(o&&l&&g))throw new Error("Cannot build file list");if(a=document.getElementById("octohaven-job-delay"),!a)throw new Error("Cannot find delay element");if(I=document.getElementById("octohaven-templates"),P=document.getElementById("octohaven-save-template"),!I||!P)throw new Error("Cannot find template elements");if(M=document.getElementById("octohaven-submit-job"),j=document.getElementById("octohaven-validation-status"),!M||!j)throw new Error("Submit requirements failed");e=!1,t=new this.Template({name:x.generate(),entrypoint:"org.test.Main","driver-memory":"8g","executor-memory":"8g",options:"",jobconf:"",delay:"0",jar:""}),v=function(t){return t?B.addClass(j,"loading"):B.removeClass(j,"loading")},y=function(t,e){var n,o;return j.innerHTML="",n=t?"success-box":"error-box",o={type:"div",cls:n,children:e},T.parseMapForParent(o,j)},b=function(t,e){return y(t,{type:"span",title:""+e})},h=function(t,e,n,o){var r,i;return i=o?"a":"div",r={type:""+i,cls:""+e,title:""+t,onclick:function(t){return"function"==typeof o&&o(this),t.preventDefault(),t.stopPropagation()}},r=T.parseMapForParent(r),r.path=n,r},f=null,n=function(t,e,r){return F.breadcrumbs(t,function(){return o.innerHTML=""},function(t){return function(t,i){var a,u,s,c,l,m,f,d;if(t){for(d=[[],i.content.breadcrumbs],a=d[0],l=d[1],s=m=0,f=l.length;f>m;s=++m)c=l[s],s<l.length-1?(u=h(c.name,"section",c.path,function(t){return("function"==typeof e?e(t):void 0)?(n(t.obj.path,e,r),p(t.obj.path,e,r)):void 0}),u.obj=c,"function"==typeof r&&r(u),a.push(u),a.push({type:"div",cls:"separator",title:"/"})):(u=h(c.name,"active section",c.path),u.obj=c,"function"==typeof r&&r(u),a.push(u));return T.parseMapForParent(a,o)}return i?b(!1,i.content.msg):b(!1,"Something went wrong :(")}}(this))},p=function(t,e,o){return F.files(t,function(){return l.innerHTML=""},function(t){return function(t,r){var i,a,u,s,c,m,f;if(t){for(f=[[],r.content.list],i=f[0],s=f[1],c=0,m=s.length;m>c;c++)u=s[c],a={type:"a",cls:"menu-item",href:"",title:"["+u.tp+"] "+u.name},a.onclick=function(t){return("function"==typeof e?e(this):void 0)&&(n(this.obj.path,e,o),p(this.obj.path,e,o)),t.preventDefault(),t.stopPropagation()},a=T.parseMapForParent(a),a.obj=u,"function"==typeof o&&o(a),i.push(a);return T.parseMapForParent(i,l)}return r?b(!1,r.content.msg):b(!1,"Something went wrong :(")}}(this))},a.innerHTML="",u=function(t,e){var n,o;return o={type:"a",cls:"menu-item",title:""+t,href:""},n=T.parseMapForParent(o,a),n.diff=e,n},s={0:u("Right away",0),600:u("In 10 minutes",600),1800:u("In 30 minutes",1800),3600:u("In 1 hour",3600),10800:u("In 3 hours",10800),86400:u("Next day",86400)},d=function(t){var e,o,r,i,a,u,c,l;m.innerHTML="",u=[k.dynamicOption("Job name","Friendly job name",t.get("name"),function(e,n){return e?t.set("name",""+n):void 0}),k.dynamicOption("Main class","Entrypoint for the job",t.get("entrypoint"),function(e,n){return e?t.set("entrypoint",""+n):void 0}),k.dynamicOption("Driver memory","Memory for the driver programme",t.get("driver-memory"),function(e,n){return e?t.set("driver-memory",""+n):void 0}),k.dynamicOption("Executor memory","Memory for Spark executors",t.get("executor-memory"),function(e,n){return e?t.set("executor-memory",""+n):void 0}),k.dynamicOption("Spark options","Settings, e.g. JVM, networking, shuffle...",t.get("options"),function(e,n){return e?t.set("options",""+n):void 0}),k.dynamicOption("Job options","Job options to pass to entrypoint",t.get("jobconf"),function(e,n){return e?t.set("jobconf",""+n):void 0})],o=k.segments(u,m),g.innerHTML=""!==t.get("jar")?""+t.get("jar"):"&nbsp;",c=function(e){return"JAR"===e.obj.tp?(t.set("jar",""+e.obj.path),g.innerHTML=t.get("jar"),a(e),!1):!0},a=function(e){var n;return n=e.obj,"JAR"===n.tp&&n.path===t.get("jar")?(f&&B.removeClass(f,"selected"),B.addClass(e,"selected"),f=e):void 0},n("",c,a),p("",c,a),e=function(e){var n,o;null!=t&&t.set("delay",e.diff);for(o in s)n=s[o],B.removeClass(n,"selected");return B.addClass(e,"selected")},i=function(t){var n;return n=B.intOrElse(t,0),t=n in s?s[n]:s[0],e(t)};for(r in s)l=s[r],B.addEventListener(l,"click",function(t){return e(this),t.preventDefault(),t.stopPropagation()});return i(t.get("delay"))},E=function(t){var n;return v(!0),e?(b(!1,"You cannot resubmit the job"),v(!1)):(e=!0,n=t.settings,C.submit(n,null,function(t,n){var o,r,i;return v(!1),t?(i=n.content.msg,r=n.content.jobid,o={type:"span",title:i+". ",children:{type:"a",title:"View details",href:"/job?jobid="+r}},y(t,o)):(e=!1,i=n?n.content.msg:"Something went wrong :(",b(t,i))}))},S=function(t,e,n){var o,r,a;return r={type:"div",cls:"btn btn-link btn-micro tooltipped tooltipped-e",onclick:function(t){return c(this.uid),t.preventDefault(),t.stopPropagation()}},r=T.parseMapForParent(r),r.innerHTML="&times;",r.uid=t,r.setAttribute("aria-label","Delete"),a={type:"span",title:""+e},o={type:"a",href:"",cls:"menu-item",children:[r,a],onclick:function(t){return i.settings=this.content,d(i),b(!0,"Template has been loaded"),t.preventDefault(),t.stopPropagation()}},o=T.parseMapForParent(o),o.content=n,o},w=function(){return L.show(function(){var t,e,n;for(t=I.nextSibling,n=[];t;)e=t.nextSibling,t.parentNode.removeChild(t),n.push(t=e);return n},function(t,e){var n,o,r,i,a,u,s,c,p;if(a=I.parentNode,t){for(n=e.content.templates,p=[],s=0,c=n.length;c>s;s++)r=n[s],u=r.uid,i=r.name,o=r.content,p.push(T.parseMapForParent(S(u,i,o),a));return p}return b(t,"Something went wrong")})},c=function(t){return L["delete"](t,null,function(t,e){var n;return n=t?e.content.msg:"Something went wrong",b(t,n),w()})},r=function(t,e){var n;return v(!0),n={name:""+t,content:e},L.create(n,null,function(t,e){var n;return v(!1),n=e?e.content.msg:"Something went wrong :(",b(t,n),t?w():void 0})},new this.FastEditor(P,function(t,e){return t?r(e,i.settings):void 0},"Save","Cancel","Name of template",!1),i=t,w(),d(i),B.addEventListener(M,"click",function(t){return E(i),t.preventDefault(),t.stopPropagation()})}).call(this);